{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst createHash = require(\"./util/createHash\");\n\nconst RequestShortener = require(\"./RequestShortener\");\n\nconst getHash = str => {\n  const hash = createHash(\"md4\");\n  hash.update(str);\n  const digest =\n  /** @type {string} */\n  hash.digest(\"hex\");\n  return digest.substr(0, 4);\n};\n\nclass NamedModulesPlugin {\n  constructor(options) {\n    this.options = options || {};\n  }\n\n  apply(compiler) {\n    compiler.hooks.compilation.tap(\"NamedModulesPlugin\", compilation => {\n      compilation.hooks.beforeModuleIds.tap(\"NamedModulesPlugin\", modules => {\n        const namedModules = new Map();\n        const context = this.options.context || compiler.options.context;\n\n        for (const module of modules) {\n          if (module.id === null && module.libIdent) {\n            module.id = module.libIdent({\n              context\n            });\n          }\n\n          if (module.id !== null) {\n            const namedModule = namedModules.get(module.id);\n\n            if (namedModule !== undefined) {\n              namedModule.push(module);\n            } else {\n              namedModules.set(module.id, [module]);\n            }\n          }\n        }\n\n        for (const namedModule of namedModules.values()) {\n          if (namedModule.length > 1) {\n            for (const module of namedModule) {\n              const requestShortener = new RequestShortener(context);\n              module.id = \"\".concat(module.id, \"?\").concat(getHash(requestShortener.shorten(module.identifier())));\n            }\n          }\n        }\n      });\n    });\n  }\n\n}\n\nmodule.exports = NamedModulesPlugin;","map":null,"metadata":{},"sourceType":"script"}