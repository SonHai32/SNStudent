{"ast":null,"code":"// Usage:\n//    let firstArg = 'selectedLogoFile';                  //<input type=\"file\" id=\"selectedLogoFile\">\n//    let secondArg = 300;                                //300px\n//    let thirdArg = (dataUrl)=> console.log(dataUrl);    //(dataUrl) => document.getElementById('image-output').src = dataUrl;\n//\n//    this.image = new imageResizer(firstArg, secondArg, thirdArg);\n//\n// When uploaded file:\n//    var formData = new FormData();\n//    formData.append('files[0]', this.image.blob);\n//\n//    document.getElementById('image-output').src = this.image.dataUrl;\nexport default class imageSqResizer {\n  constructor(uploaderId, size, setDataUrlFunc) {\n    this._setDataUrlFunc = setDataUrlFunc;\n    this._size = size;\n    this._blob = null;\n    this._dataUrl = null;\n    let upload = document.getElementById(uploaderId);\n    upload.addEventListener('change', () => {\n      Array.from(upload.files).forEach(file => {\n        let imageType = /image.*/;\n\n        if (!file.type.match(imageType)) {\n          console.warn('not image type');\n          return true;\n        }\n\n        this.resized(file, this._size);\n      });\n    });\n  } //get blob object\n\n\n  get blob() {\n    return this._blob;\n  } //get dataUrl\n\n\n  get dataUrl() {\n    return this._dataUrl;\n  } // resize\n\n\n  resized(file, maxWidth) {\n    let setDataUrlFunc = this._setDataUrlFunc || false;\n    let reader = new FileReader();\n\n    reader.onload = () => {\n      let tempImg = new Image();\n      tempImg.src = reader.result;\n\n      let createCanvas = (width, height, img) => {\n        let canvas = document.createElement('canvas');\n        canvas.width = width;\n        canvas.height = height;\n        let ctx = canvas.getContext('2d');\n        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n        this._dataUrl = canvas.toDataURL();\n\n        if (setDataUrlFunc) {\n          setDataUrlFunc(canvas.toDataURL());\n        }\n\n        canvas.toBlob(blob => {\n          this._blob = blob;\n        });\n      };\n\n      tempImg.onload = () => {\n        // calc size\n        let tempW = tempImg.width;\n        let tempH = tempImg.height;\n        let min = tempW >= tempH ? tempH : tempW;\n        maxWidth = maxWidth || min;\n\n        if (tempH <= maxWidth && tempW <= maxWidth) {\n          createCanvas(tempW, tempH, tempImg);\n        }\n\n        let startY = 0;\n\n        if (min !== tempH) {\n          startY = Math.round(tempH / 2 - min / 2);\n        }\n\n        let startX = 0;\n\n        if (min !== tempW) {\n          startX = Math.round(tempW / 2 - min / 2);\n        }\n\n        let finalImg = new Image();\n        finalImg.src = this.getImagePortion(tempImg, min, min, startX, startY, 1);\n\n        finalImg.onload = () => {\n          createCanvas(maxWidth, maxWidth, finalImg);\n        };\n      };\n    };\n\n    reader.readAsDataURL(file);\n  } //image crop\n\n\n  getImagePortion(imgObj, newWidth, newHeight, startX, startY, ratio) {\n    let tnCanvas = document.createElement('canvas');\n    let tnCanvasContext = tnCanvas.getContext('2d');\n    tnCanvas.width = newWidth;\n    tnCanvas.height = newHeight;\n    let bufferCanvas = document.createElement('canvas');\n    let bufferContext = bufferCanvas.getContext('2d');\n    bufferCanvas.width = imgObj.width;\n    bufferCanvas.height = imgObj.height;\n    bufferContext.drawImage(imgObj, 0, 0);\n    tnCanvasContext.drawImage(bufferCanvas, startX, startY, newWidth * ratio, newHeight * ratio, 0, 0, newWidth, newHeight);\n    return tnCanvas.toDataURL();\n  }\n\n}","map":{"version":3,"sources":["/home/hari/Desktop/web-dev/React/SNStudent/src/components/image-square-resizer.js"],"names":["imageSqResizer","constructor","uploaderId","size","setDataUrlFunc","_setDataUrlFunc","_size","_blob","_dataUrl","upload","document","getElementById","addEventListener","Array","from","files","forEach","file","imageType","type","match","console","warn","resized","blob","dataUrl","maxWidth","reader","FileReader","onload","tempImg","Image","src","result","createCanvas","width","height","img","canvas","createElement","ctx","getContext","drawImage","toDataURL","toBlob","tempW","tempH","min","startY","Math","round","startX","finalImg","getImagePortion","readAsDataURL","imgObj","newWidth","newHeight","ratio","tnCanvas","tnCanvasContext","bufferCanvas","bufferContext"],"mappings":"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","sourcesContent":["// Usage:\n//    let firstArg = 'selectedLogoFile';                  //<input type=\"file\" id=\"selectedLogoFile\">\n//    let secondArg = 300;                                //300px\n//    let thirdArg = (dataUrl)=> console.log(dataUrl);    //(dataUrl) => document.getElementById('image-output').src = dataUrl;\n//\n//    this.image = new imageResizer(firstArg, secondArg, thirdArg);\n//\n// When uploaded file:\n//    var formData = new FormData();\n//    formData.append('files[0]', this.image.blob);\n//\n//    document.getElementById('image-output').src = this.image.dataUrl;\n\n\n\n\nexport default class imageSqResizer {\n\n    constructor(uploaderId, size, setDataUrlFunc) {\n\n        this._setDataUrlFunc = setDataUrlFunc;\n        this._size = size;\n        this._blob = null;\n        this._dataUrl = null;\n\n        let upload = document.getElementById(uploaderId);\n\n        upload.addEventListener('change', () => {\n            Array.from(upload.files).forEach(file => {\n                let imageType = /image.*/;\n                if (!file.type.match(imageType)) {\n                    console.warn('not image type');\n                    return true;\n                }\n                this.resized(file, this._size);\n            });\n        });\n    }\n\n    //get blob object\n    get blob() { return this._blob; }\n        //get dataUrl\n    get dataUrl() { return this._dataUrl; }\n\n    // resize\n    resized(file, maxWidth) {\n        let setDataUrlFunc = this._setDataUrlFunc || false;\n        let reader = new FileReader();\n        reader.onload = () => {\n\n            let tempImg = new Image();\n            tempImg.src = reader.result;\n\n            let createCanvas = (width, height, img) => {\n                let canvas = document.createElement('canvas');\n                canvas.width = width;\n                canvas.height = height;\n                let ctx = canvas.getContext('2d');\n                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n                this._dataUrl = canvas.toDataURL();\n                if (setDataUrlFunc) {\n                    setDataUrlFunc(canvas.toDataURL());\n                }\n                canvas.toBlob((blob) => {\n                    this._blob = blob;\n                });\n            }\n\n            tempImg.onload = () => {\n\n                // calc size\n                let tempW = tempImg.width;\n                let tempH = tempImg.height;\n                let min = tempW >= tempH ? tempH : tempW;\n                maxWidth = maxWidth || min;\n\n                if (tempH <= maxWidth && tempW <= maxWidth) {\n                    createCanvas(tempW, tempH, tempImg);\n                }\n\n                let startY = 0;\n                if (min !== tempH) {\n                    startY = Math.round(tempH / 2 - (min / 2));\n                }\n                let startX = 0;\n                if (min !== tempW) {\n                    startX = Math.round(tempW / 2 - (min / 2));\n                }\n\n                let finalImg = new Image();\n                finalImg.src = this.getImagePortion(tempImg, min, min, startX, startY, 1);\n\n                finalImg.onload = () => {\n                    createCanvas(maxWidth, maxWidth, finalImg);\n                }\n            }\n        }\n        reader.readAsDataURL(file);\n    }\n\n    //image crop\n    getImagePortion(imgObj, newWidth, newHeight, startX, startY, ratio) {\n        let tnCanvas = document.createElement('canvas');\n        let tnCanvasContext = tnCanvas.getContext('2d');\n        tnCanvas.width = newWidth;\n        tnCanvas.height = newHeight;\n\n        let bufferCanvas = document.createElement('canvas');\n        let bufferContext = bufferCanvas.getContext('2d');\n        bufferCanvas.width = imgObj.width;\n        bufferCanvas.height = imgObj.height;\n        bufferContext.drawImage(imgObj, 0, 0);\n\n        tnCanvasContext.drawImage(bufferCanvas, startX, startY, newWidth * ratio, newHeight * ratio, 0, 0, newWidth, newHeight);\n        return tnCanvas.toDataURL();\n    }\n}"]},"metadata":{},"sourceType":"module"}